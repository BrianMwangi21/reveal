# Session 04 - Phase 3: Pre-Reveal Activities

**Date**: January 3, 2026
**Phase**: Phase 3 - Pre-Reveal Activities

## Summary

Implemented interactive pre-reveal activities system that allows hosts to create games for guests to participate in before the reveal happens. Added mobile-first responsive design and user identification features.

## Work Completed

### Activity System
- **Created Activity schemas** in `lib/models/`:
  - `Activity.ts` - Base activity model (tracks all activities)
  - `Bet.ts` - "Bet Your Points" game with options and point-based betting
  - `ClosestGuess.ts` - Number prediction game
  - `Message.ts` - Message board with emoji reactions

- **Built API endpoints** in `app/api/activities/`:
  - `GET/POST /api/activities` - List/create activities
  - `GET/POST /api/activities/bet/[activityId]` - Manage bet games
  - `POST /api/activities/bet/[activityId]/bet` - Place/update bets
  - `GET/POST /api/activities/closestGuess/[activityId]` - Manage closest guess games
  - `POST /api/activities/closestGuess/[activityId]/guess` - Submit guesses
  - `GET/POST /api/activities/message/[activityId]` - Manage message boards
  - `POST /api/activities/message/[activityId]/message` - Post messages
  - `POST /api/activities/message/[activityId]/message/[messageId]/react` - Toggle emoji reactions
  - `DELETE /api/activities/[activityId]` - Delete activities (host only)

- **Created Activity Components** in `app/components/reveal/`:
  - `ActivityCreator.tsx` - Modal for hosts to create activities
  - `Bet.tsx` - Displays options, allows betting (0-100 pts), shows bet statistics
  - `ClosestGuess.tsx` - Displays question, allows number input, shows all guesses
  - `MessageBoard.tsx` - Post messages, react with emojis (‚ù§Ô∏èüòÇüéâü•≥üëçüôåüíØüòç), view all messages

### UX Improvements
- **Current User Display**:
  - Added nickname display in room page header
  - Current user highlighted in pink in GuestList component
  - Messages from current user highlighted with pink background

- **Activity Management**:
  - Delete button on activity cards (host only)
  - Confirmation dialog before deletion
  - Activities refresh automatically after creation/deletion

- **Mobile-First Design**:
  - All components responsive (sm, md, lg breakpoints)
  - Flexible grid layouts
  - Touch-friendly buttons and inputs
  - Compact spacing on mobile, expanded on desktop

### Bug Fixes
- **Host Session Issue**: Fixed host not being recognized after room creation
  - Now saves host as Guest in database with `host: true`
  - Host ID in room matches guest session ID
  - Host automatically has access to activity creation

- **Activity Type Selection**: Removed "Bet Your Points" from create dropdown (kept code for future use)

## Tech Decisions

### Activity Design
- **Activity-First Architecture**: Activities are separate from rooms, allowing multiple activities per room
- **Activity ID Format**: `${roomCode}-${timestamp}-${random}` for uniqueness
- **Reactions System**: Used Map<emoji, string[]> for efficient reaction tracking

### Bet Your Points (Hidden)
- Complete betting system implemented but hidden from UI
- Points: 0-100 per guest
- Visible bets (not hidden for suspense)
- Can be re-enabled by adding back to ActivityCreator dropdown

### Closest Guess
- Simple number prediction game
- Unit field for display (oz, lbs, minutes, etc.)
- Shows all guesses sorted by value
- Host can reveal correct value after reveal

### Message Board
- 280 character limit
- 8 emoji reactions available
- Reactions are toggleable (add/remove)
- Messages sorted by newest first
- Current user messages highlighted

## Files Created

### Models
- `lib/models/Activity.ts`
- `lib/models/Bet.ts`
- `lib/models/ClosestGuess.ts`
- `lib/models/Message.ts`

### API Routes
- `app/api/activities/route.ts`
- `app/api/activities/[activityId]/route.ts`
- `app/api/activities/bet/[activityId]/route.ts`
- `app/api/activities/bet/[activityId]/bet/route.ts`
- `app/api/activities/closestGuess/[activityId]/route.ts`
- `app/api/activities/closestGuess/[activityId]/guess/route.ts`
- `app/api/activities/message/[activityId]/route.ts`
- `app/api/activities/message/[activityId]/message/route.ts`
- `app/api/activities/message/[activityId]/message/[messageId]/react/route.ts`

### Components
- `app/components/reveal/ActivityCreator.tsx`
- `app/components/reveal/Bet.tsx`
- `app/components/reveal/ClosestGuess.tsx`
- `app/components/reveal/MessageBoard.tsx`

## Files Modified

- `app/create/page.tsx` - Fixed host session creation, improved error handling
- `app/api/rooms/route.ts` - Auto-join host as guest on room creation
- `app/rooms/[code]/page.tsx` - Added activities display, current user display, host controls
- `app/components/reveal/GuestList.tsx` - Highlight current user in pink
- `ROADMAP.md` - Marked Phase 3 complete

## Definition of Done ‚úÖ

- [x] Hosts can create activities (closest guess, message board)
- [x] Guests can participate in all activities
- [x] Current user is highlighted in UI
- [x] Activities can be deleted by hosts
- [x] Mobile-first responsive design implemented
- [x] All lint and typecheck passing
- [ ] Real-time updates (Phase 4 - WebSocket integration)

## Testing Notes

**Tested by User**:
- Created new room as host
- Host automatically joined as guest
- Created Closest Guess activity
- Created Message Board activity
- Tested deletion of activities
- Tested mobile responsiveness

## Next Steps

**Phase 4: Real-Time WebSocket Integration**
- Set up WebSocket server (consider SSE for Vercel compatibility)
- Design event schema for real-time updates
- Implement room-based connection management
- Add activity update broadcasts
- Handle WebSocket reconnections
- Add connection status indicator

## Issues/Notes

- Bet Your Points feature complete but hidden from UI per user request
- Can re-enable by adding `<option value="bet">Bet Your Points</option>` to ActivityCreator dropdown
- Real-time updates currently use polling (every 5 seconds) - will upgrade to WebSocket in Phase 4
